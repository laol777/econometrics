Определение длины M - в выборке trainDelta находим наиболее длинные участки, удовлетворяющие условию p-value < k. Среди них берем выборку с наименьшим математическим ожиданием.


		Мой метод
Разбиваем исходные данные на 3 части тренировочная, тестовая и валидационная.
Далее весь ряд диффиринцируем и также разбиваем на три части.
Находим соответсвие индексов между выборками - в виде датафрейма с 3 колонками (общий индекс, локальный индекс соответвующий положительной выборке или ноль, локальный индекс соответсвующий отрицательной выборке или ноль).
Находим индекс iMax идущий за максимально схожей выборкой для отрицательный дельт и для положительных. Находим коэффиценты k и offset по МНК для аппроксимируемых выборок и для выборок стартовый индекс которых (Imax - lenght(M)), длиной lenght(M). Мы хотим предсказать, какое значение будет на P дней вперед. Для этого мы предскажем прирост для каждого дня p из [1, Plength] = P независимо, где Plength равно длине P. Для этого смотрим сколько локальных индексов попало в промежуток p глобального индекса, где Pstart - локальный индекс относительно глобального, Pend это Pstart + lenght(p). Далее положительный прирост складываем с отрицательным и получаем прогноз прироста на p день относительно последнего известного из выборки M. Получается, что предказание на p день не зависит от предсказаний соседствующих с ним, следовательно впоследствии можно как-либо учитывать взаимосвязь соседних предсказаний.